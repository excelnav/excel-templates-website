{{ define "main" }}
{{ $screenshots := .Params.screenshots | default (slice .Params.featured_image) }}
<article class="template-detail">
    <!-- Breadcrumb Navigation -->
    <div class="container">
        {{ partial "breadcrumb.html" . }}
    </div>

    <!-- Template Title Section -->
    <section class="template-title-section">
        <div class="container">
            <h1 class="template-title">{{ .Title }}</h1>
            <p class="template-description">{{ .Description }}</p>
        </div>
    </section>

    <!-- Screenshot Gallery Section -->
    <section class="screenshot-gallery">
        <div class="container">
            <div class="gallery-container">
                <!-- Main Screenshot Display -->
                <div class="main-screenshot">
                    {{ if $screenshots }}
                    <div class="screenshot-viewer">
                        <img id="main-screenshot" src="{{ index $screenshots 0 }}" alt="{{ .Title }} screenshot" class="screenshot-image" onclick="openFullscreen()" style="cursor: pointer;">
                        <button class="fullscreen-btn" onclick="openFullscreen()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        {{ if gt (len $screenshots) 1 }}
                        <button class="nav-btn prev-btn" onclick="previousImage()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polyline points="15,18 9,12 15,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="nav-btn next-btn" onclick="nextImage()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polyline points="9,18 15,12 9,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        {{ end }}
                    </div>
                    {{ end }}
                </div>

                <!-- Thumbnail Navigation -->
                {{ if gt (len $screenshots) 1 }}
                <div class="thumbnail-nav">
                    {{ range $index, $screenshot := $screenshots }}
                    <button class="thumbnail {{ if eq $index 0 }}active{{ end }}" onclick="showImage({{ $index }})" data-index="{{ $index }}">
                        <img src="{{ $screenshot }}" alt="Screenshot {{ add $index 1 }}">
                    </button>
                    {{ end }}
                </div>
                {{ end }}
            </div>
        </div>
    </section>



    <!-- Fullscreen Modal -->
    <div id="fullscreen-modal" class="fullscreen-modal">
        <div class="fullscreen-content">
            <button class="close-btn" onclick="closeFullscreen()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <img id="fullscreen-image" src="" alt="Full size screenshot">
            {{ if gt (len $screenshots) 1 }}
            <button class="fullscreen-nav prev" onclick="previousImageFullscreen()">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <polyline points="15,18 9,12 15,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <button class="fullscreen-nav next" onclick="nextImageFullscreen()">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <polyline points="9,18 15,12 9,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            {{ end }}
        </div>
    </div>

    <!-- Hidden data for JavaScript -->
    <script type="application/json" id="screenshot-data">
    {
        "screenshots": [{{ range $index, $screenshot := $screenshots }}{{ if $index }},{{ end }}"{{ $screenshot }}"{{ end }}],
        "currentIndex": 0
    }
    </script>

    <!-- Template Content -->
    <section class="template-content-section">
        <div class="container">
            <div class="content-grid">
                <!-- Main Content -->
                <div class="main-content">
                    <div class="content-block">
                        <h2>Template Overview</h2>
                        {{ .Content }}
                    </div>
                    
                 <!-- Features List 
                   {{ with .Params.features }}
                    <div class="content-block">
                       <h2>Key Features</h2>
                         <ul class="features-list">
                             {{ range . }}
                            <li class="feature-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                     <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                 </svg>
                                {{ . }}
                            </li>
                            {{ end }}
                        </ul>
                    </div>                    
                     {{ end }}  
                     -->
                    
                    <!-- How to Use -->
                    {{ with .Params.how_to_use }}
                    <div class="content-block">
                        <h2>How to Use This Template</h2>
                        <ol class="instructions-list">
                            {{ range . }}
                            <li>{{ . }}</li>
                            {{ end }}
                        </ol>
                    </div>
                    {{ end }}
                    
                    <!-- Requirements -->
                    {{ with .Params.requirements }}
                    <div class="content-block">
                        <h2>Requirements</h2>
                        <ul class="requirements-list">
                            {{ range . }}
                            <li>{{ . }}</li>
                            {{ end }}
                        </ul>
                    </div>
                    {{ end }}
                </div>
                
                <!-- Sidebar -->
                <aside class="sidebar">
                    <!-- Download Card -->
                    <div class="sidebar-card download-card">
                        <h3>Download Information</h3>
                        <div class="download-stats">
                            {{ with .Params.categories }}
                            <div class="stat-item">
                                <span class="stat-label">Categories</span>
                                <div class="stat-value categories-container">
                                    {{ range . }}
                                    <a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}" class="category-tag">{{ . }}</a>
                                    {{ end }}
                                </div>
                            </div>
                            {{ end }}
                            

                            <div class="stat-item">
                                <span class="stat-label">File Format</span>
                                <span class="stat-value">.xlsx</span>
                            </div>
                            
                            {{ with .Params.file_size }}
                            <div class="stat-item">
                                <span class="stat-label">File Size</span>
                                <span class="stat-value">{{ . }}</span>
                            </div>
                            {{ end }}
                            
                            {{ with .Params.excel_version }}
                            <div class="stat-item">
                                <span class="stat-label">Excel Version</span>
                                <span class="stat-value">{{ . }}</span>
                            </div>
                            {{ end }}
                            
                            <div class="stat-item">
                                <span class="stat-label">Last Updated</span>
                                <span class="stat-value">{{ .Date.Format "January 2, 2006" }}</span>
                            </div>
                            
                            <div class="stat-item">
                                <span class="stat-label">License</span>
                                <span class="stat-value">Free for Commercial Use</span>
                            </div>
                        </div>
                        
                        <div class="download-actions">
                            <a href="{{ .Params.download_url }}" class="btn btn-primary btn-block download-btn" download>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Download Now
                            </a>
                            
                            {{ if and .Params.google_sheet_url (ne .Params.enable_google_sheet false) }}
                            <a href="{{ .Params.google_sheet_url }}" class="btn btn-success btn-block google-sheet-btn" target="_blank" rel="noopener">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" fill="currentColor"/>
                                    <path d="M8,12V14H16V12H8M8,16V18H13V16H8Z" fill="currentColor"/>
                                </svg>
                                Google Sheets
                            </a>
                            {{ end }}
                        </div>
                        
                        <!-- Share Buttons -->
                        <div class="share-buttons-compact">
                            <div class="share-label">Share:</div>
                            <a href="https://twitter.com/intent/tweet?url={{ .Permalink }}&text={{ .Title }}" class="share-btn-compact twitter" target="_blank" rel="noopener" title="Share on Twitter">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                </svg>
                            </a>
                            
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" class="share-btn-compact facebook" target="_blank" rel="noopener" title="Share on Facebook">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                </svg>
                            </a>
                            
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ .Permalink }}" class="share-btn-compact linkedin" target="_blank" rel="noopener" title="Share on LinkedIn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Tags Card -->
                    {{ with .Params.tags }}
                    <div class="sidebar-card tags-card">
                        <h3>Tags</h3>
                        <div class="tags-grid">
                            {{ range . }}
                            <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="tag-badge">{{ . }}</a>
                            {{ end }}
                        </div>
                    </div>
                    {{ end }}
                    
                    <!-- Related Templates -->
                    <div class="sidebar-card">
                        <h3>Related Templates</h3>
                        <div class="related-templates">
                            {{ $related := .Site.RegularPages.Related . | first 3 }}
                            {{ range $related }}
                            <div class="related-item">
                                {{ with .Params.featured_image }}
                                <img src="{{ . }}" alt="{{ $.Title }}" class="related-image">
                                {{ end }}
                                <div class="related-content">
                                    <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
                                    <p>{{ .Description | truncate 60 }}</p>
                                </div>
                            </div>
                            {{ end }}
                        </div>
                    </div>
                    

                </aside>
            </div>
        </div>
    </section>
</article>

<!-- 全屏模态框 -->
<div id="fullscreen-modal" class="fullscreen-modal">
    <div class="fullscreen-content">
        <img id="fullscreen-image" src="" alt="Full size screenshot">
        <button class="close-btn" onclick="closeFullscreen()">&times;</button>
        <div class="fullscreen-nav">
            <button class="nav-btn prev-btn" onclick="previousImageFullscreen()">&#8249;</button>
            <button class="nav-btn next-btn" onclick="nextImageFullscreen()">&#8250;</button>
        </div>
    </div>
</div>

<!-- JSON-LD Structured Data for Template -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "{{ .Title }}",
    "description": "{{ .Description }}",
    "url": "{{ .Permalink }}",
    "downloadUrl": "{{ .Params.download_url }}",
    "applicationCategory": "Spreadsheet Template",
    "operatingSystem": "Microsoft Excel",
    "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
    },
    "author": {
        "@type": "Organization",
        "name": "{{ .Site.Title }}"
    },
    "datePublished": "{{ .Date.Format "2006-01-02" }}",
    "dateModified": "{{ .Lastmod.Format "2006-01-02" }}"
}
</script>
{{ end }}